!function(o){"use strict";window.GOVUK=window.GOVUK||{};var e=function(e,r){return"<a "+(r=r?'class="'+r+'"':"")+' href="{{surveyUrl}}" id="take-survey" target="_blank" rel="noopener noreferrer">'+e+"</a>"},r=function(e){return'<section id="user-satisfaction-survey" class="visible" aria-hidden="false">  <div class="survey-wrapper">    <a class="survey-close-button" href="#user-survey-cancel" aria-labelledby="survey-title user-survey-cancel" id="user-survey-cancel" role="button">Close</a>    <h2 class="survey-title" id="survey-title">{{title}}</h2>'+e+"  </div></section>"},t=r("<p>"+e("{{surveyCta}}","survey-primary-link")+' <span class="postscript-cta">{{surveyCtaPostscript}}</span></p>'),i=r('<div id="email-survey-pre">  <a class="survey-primary-link" href="#email-survey-form" id="email-survey-open" rel="noopener noreferrer" role="button" aria-expanded="false">    {{surveyCta}}  </a></div><form id="email-survey-form" action="/contact/govuk/email-survey-signup" method="post" class="js-hidden" aria-hidden="true">  <div class="survey-inner-wrapper">    <div id="survey-form-description" class="survey-form-description">{{surveyFormDescription}}      <br> {{surveyFormCtaPostscript}}    </div>    <label class="survey-form-label" for="survey-email-address">      Email Address    </label>    <input name="email_survey_signup[survey_id]" type="hidden" value="{{surveyId}}">    <input name="email_survey_signup[survey_source]" type="hidden" value="{{surveySource}}">    <input name="email_survey_signup[ga_client_id]" type="hidden" value="{{gaClientId}}">    <input class="survey-form-input" name="email_survey_signup[email_address]" id="survey-email-address" type="text" aria-describedby="survey-form-description">    <button class="survey-form-button" type="submit">{{surveyFormCta}}</button>'+e("{{surveyFormNoEmailInvite}}")+'  </div></form><div id="email-survey-post-success" class="js-hidden" aria-hidden="true" tabindex="-1">  {{surveySuccess}}</div><div id="email-survey-post-failure" class="js-hidden" aria-hidden="true" tabindex="-1">  {{surveyFailure}}</div>'),n=2,a="(max-width: 800px)",c={defaultSurvey:{url:"https://www.smartsurvey.co.uk/s/gov_uk?c={{currentPath}}",identifier:"user_satisfaction_survey",frequency:6,surveyType:"email"},smallSurveys:[{identifier:"#Userpanel",surveyType:"url",frequency:5,startTime:new Date("February 01, 2019").getTime(),endTime:new Date("December 31, 2019").getTime(),url:"https://response.questback.com/intellectualpropertyoffice/ipocustomerpanel?c={{currentPath}}",templateArgs:{title:"Help improve our online services",surveyCta:"Join the IPO user panel",surveyCtaPostscript:"(opens in new window)"},activeWhen:{path:["^/topic/intellectual-property/trade-marks","^/topic/intellectual-property/patents","^/topic/intellectual-property/designs","^/government/organisations/intellectual-property-office","^/how-to-register-a-trade-mark","^/apply-for-a-patent","^/apply-register-design"]}},{identifier:"service_standards_reports_survey",surveyType:"url",frequency:1,startTime:new Date("February 07, 2019").getTime(),endTime:new Date("April 07, 2019").getTime(),url:"https://www.smartsurvey.co.uk/s/service-standard-reports/",templateArgs:{title:"Help us improve Service Standards Reports on GOV.UK",surveyCta:"Take the 3 minute survey",surveyCtaPostscript:"(This will open a short survey on another website)"},activeWhen:{path:["^/service-standard-reports"]}}],init:function(){if(c.canShowAnySurvey()){var e=c.getActiveSurvey(c.defaultSurvey,c.smallSurveys);e!==undefined&&(o("#global-bar").hide(),c.displaySurvey(e))}},canShowAnySurvey:function(){return!c.pathInBlacklist()&&(!c.otherNotificationVisible()&&(!c.userCompletedTransaction()&&!(o("#user-satisfaction-survey-container").length<=0)))},processTemplate:function(e,n){return o.each(e,function(e,r){n=n.replace(new RegExp("{{"+e+"}}","g"),r)}),n},getUrlSurveyTemplate:function(){return{render:function(e){var r={title:"Tell us what you think of GOV.UK",surveyCta:"Take the 3 minute survey",surveyCtaPostscript:"This will open a short survey on another website",surveyUrl:c.addParamsToURL(c.getSurveyUrl(e))},n=o.extend(r,e.templateArgs);return c.processTemplate(n,t)}}},getEmailSurveyTemplate:function(){return{render:function(e){var r={title:"Tell us what you think of GOV.UK",surveyCta:"Take a short survey to give us your feedback",surveyFormDescription:"We\u2019ll send you a link to a feedback form. It only takes 2 minutes to fill in.",surveyFormCta:"Send me the survey",surveyFormCtaPostscript:"Don\u2019t worry: we won\u2019t send you spam or share your email address with anyone.",surveyFormNoEmailInvite:"Don\u2019t have an email address?",surveySuccess:"Thanks, we\u2019ve sent you an email with a link to the survey.",surveyFailure:"Sorry, we\u2019re unable to send you an email right now. Please try again later.",surveyId:e.identifier,surveySource:c.currentPath(),surveyUrl:c.addParamsToURL(c.getSurveyUrl(e)),gaClientId:GOVUK.analytics.gaClientId},n=o.extend(r,e.templateArgs);return c.processTemplate(n,i)}}},getActiveSurveys:function(e){return o.grep(e,function(e){if(c.currentTime()>=e.startTime&&c.currentTime()<=e.endTime)return c.activeWhen(e)})},getDisplayableSurveys:function(e){return o.grep(e,function(e){return c.isSurveyToBeDisplayed(e)})},getActiveSurvey:function(e,r){var n=c.getActiveSurveys(r),t=[e].concat(n),i=c.getDisplayableSurveys(t);return i.length<2?i[0]:i[Math.floor(Math.random()*i.length)]},displaySurvey:function(e){var r=o("#user-satisfaction-survey-container");if("email"===e.surveyType)c.displayEmailSurvey(e,r);else{if("url"!==e.surveyType&&e.surveyType!==undefined)return;c.displayURLSurvey(e,r)}c.incrementSurveySeenCounter(e),c.trackEvent(e.identifier,"banner_shown","Banner has been shown")},displayURLSurvey:function(e,r){var n=c.getUrlSurveyTemplate();r.append(n.render(e)),c.setURLSurveyEventHandlers(e)},displayEmailSurvey:function(e,r){var n=c.getEmailSurveyTemplate();r.append(n.render(e)),c.setEmailSurveyEventHandlers(e)},addParamsToURL:function(e){var r=e.replace(/\{\{currentPath\}\}/g,c.currentPath());return-1!==e.indexOf("?c=")?r+"&gcl="+GOVUK.analytics.gaClientId:r+"?gcl="+GOVUK.analytics.gaClientId},setEmailSurveyEventHandlers:function(i){var e=o("#email-survey-open"),r=o("#user-survey-cancel"),n=o("#email-survey-pre"),a=o("#email-survey-form"),s=o("#email-survey-post-success"),u=o("#email-survey-post-failure"),t=o("#survey-email-address");o("#take-survey").click(function(){c.setSurveyTakenCookie(i),c.hideSurvey(i),c.trackEvent(i.identifier,"no_email_link","User taken survey via no email link")}),e.click(function(e){return i.surveyExpanded=!0,c.trackEvent(i.identifier,"email_survey_open","Email survey opened"),n.addClass("js-hidden").attr("aria-hidden","true"),a.removeClass("js-hidden").attr("aria-hidden","false"),t.focus(),e.stopPropagation(),!1}),r.click(function(e){return c.setSurveyTakenCookie(i),c.hideSurvey(i),i.surveyExpanded?c.trackEvent(i.identifier,"email_survey_cancel","Email survey cancelled"):c.trackEvent(i.identifier,"banner_no_thanks","No thanks clicked"),e.stopPropagation(),!1}),a.submit(function(e){var r=function(){a.addClass("js-hidden").attr("aria-hidden","true"),s.removeClass("js-hidden").attr("aria-hidden","false"),s.focus(),c.setSurveyTakenCookie(i),c.trackEvent(i.identifier,"email_survey_taken","Email survey taken"),c.trackEvent(i.identifier,"banner_taken","User taken survey")},n=function(){a.addClass("js-hidden").attr("aria-hidden","true"),u.removeClass("js-hidden").attr("aria-hidden","false"),u.focus()},t=a.attr("action");return/\.js$/.test(t)||(t+=".js"),o.ajax({type:"POST",url:t,dataType:"json",data:a.serialize(),success:r,error:n,statusCode:{500:n}}),e.stopPropagation(),!1})},setURLSurveyEventHandlers:function(r){var e=o("#user-survey-cancel"),n=o("#take-survey");e.click(function(e){return c.setSurveyTakenCookie(r),c.hideSurvey(r),c.trackEvent(r.identifier,"banner_no_thanks","No thanks clicked"),e.stopPropagation(),!1}),n.click(function(){c.setSurveyTakenCookie(r),c.hideSurvey(r),c.trackEvent(r.identifier,"banner_taken","User taken survey")})},isSurveyToBeDisplayed:function(e){return!(c.isBeingViewedOnMobile()&&!c.surveyIsAllowedOnMobile(e))&&("true"!==GOVUK.cookie(c.surveyTakenCookieName(e))&&(!c.surveyHasBeenSeenTooManyTimes(e)&&c.randomNumberMatches(e.frequency)))},pathInBlacklist:function(){return new RegExp("^/(?:"+/service-manual/.source+")(?:/|$)").test(c.currentPath())},userCompletedTransaction:function(){function e(e,r){return-1<e.indexOf(r)}var r=c.currentPath();if(e(r,"/done")||e(r,"/transaction-finished")||e(r,"/driving-transaction-finished"))return!0},trackEvent:function(e,r,n){window.GOVUK.analytics.trackEvent(e,r,{label:n,value:1,nonInteraction:!0})},setSurveyTakenCookie:function(e){window.GOVUK.cookie(c.surveyTakenCookieName(e),!0,{days:90})},incrementSurveySeenCounter:function(e){var r=c.surveySeenCookieName(e),n=c.surveySeenCount(e)+1,t=c.seenTooManyTimesCooloff(e);t?window.GOVUK.cookie(r,n,{days:t}):window.GOVUK.cookie(r,n)},seenTooManyTimesCooloff:function(e){return e.seenTooManyTimesCooloff?u(e.seenTooManyTimesCooloff,undefined,1):undefined},hideSurvey:function(){o("#user-satisfaction-survey").removeClass("visible").attr("aria-hidden","true")},randomNumberMatches:function(e){return 0===Math.floor(Math.random()*e)},getSurveyUrl:function(e){return e.url instanceof Array?e.url[Math.floor(Math.random()*e.url.length)]:e.url},otherNotificationVisible:function(){return 0<o([".govuk-emergency-banner:visible","#global-cookie-message:visible","#global-browser-prompt:visible","#taxonomy-survey:visible"].join(", ")).length},surveyHasBeenSeenTooManyTimes:function(e){return c.surveySeenCount(e)>=c.surveySeenTooManyTimesLimit(e)},surveySeenTooManyTimesLimit:function(e){var r=e.seenTooManyTimesLimit;return"unlimited"===String(r).toLowerCase()?Infinity:u(r,n,1)},surveySeenCount:function(e){return u(GOVUK.cookie(c.surveySeenCookieName(e)),0,0)},surveyTakenCookieName:function(e){return s("taken_"+e.identifier)},surveySeenCookieName:function(e){return s("survey_seen_"+e.identifier)},isBeingViewedOnMobile:function(){return window.matchMedia(a).matches},surveyIsAllowedOnMobile:function(e){return e.hasOwnProperty("allowedOnMobile")&&!0===e.allowedOnMobile},pathMatch:function(e){return e!==undefined&&new RegExp(o.map(o.makeArray(e),function(e){return/[\^\$]/.test(e)?"(?:"+e+")":"(?:/"+e+"(?:/|$))"}).join("|")).test(c.currentPath())},breadcrumbMatch:function(e){return e!==undefined&&new RegExp(o.makeArray(e).join("|"),"i").test(c.currentBreadcrumb())},sectionMatch:function(e){if(e===undefined)return!1;var r=new RegExp(o.makeArray(e).join("|"),"i");return r.test(c.currentSection())||r.test(c.currentThemes())},organisationMatch:function(e){return e!==undefined&&new RegExp(o.makeArray(e).join("|")).test(c.currentOrganisation())},tlsCookieMatch:function(e){var r=c.currentTlsVersion();return e!==undefined&&""!=r&&r<e[0]},activeWhen:function(e){if(e.hasOwnProperty("activeWhen")){if(e.activeWhen.hasOwnProperty("path")||e.activeWhen.hasOwnProperty("breadcrumb")||e.activeWhen.hasOwnProperty("section")||e.activeWhen.hasOwnProperty("organisation")||e.activeWhen.hasOwnProperty("tlsCookieVersionLimit")){var r=e.activeWhen.matchType||"include",n=c.tlsCookieMatch(e.activeWhen.tlsCookieVersionLimit),t=c.pathMatch(e.activeWhen.path),i=c.breadcrumbMatch(e.activeWhen.breadcrumb),a=c.sectionMatch(e.activeWhen.section),s=c.organisationMatch(e.activeWhen.organisation),u=n||t||i||a||s;return"exclude"!==r?u:!u}return!0}return!0},currentTime:function(){return(new Date).getTime()},currentPath:function(){return window.location.pathname},currentBreadcrumb:function(){return o(".gem-c-breadcrumbs").text()||""},currentSection:function(){return o('meta[name="govuk:section"]').attr("content")||""},currentThemes:function(){return o('meta[name="govuk:themes"]').attr("content")||""},currentOrganisation:function(){return o('meta[name="govuk:analytics:organisations"]').attr("content")||""},currentTlsVersion:function(){var e=GOVUK.getCookie("TLSversion");return null==e||"unknown"==e?"":parseFloat(e.replace("TLSv",""))||""}},s=function(e){return"govuk_"+e.replace(/(\_\w)/g,function(e){return e.charAt(1).toUpperCase()})},u=function(e,r,n){var t=parseInt(e,10);return isNaN(t)||t<n?r:t};window.GOVUK.userSurveys=c,o(document).ready(function(){GOVUK.userSurveys&&(GOVUK.analytics&&GOVUK.analytics.gaClientId?window.GOVUK.userSurveys.init():o(window).on("gaClientSet",function(){window.GOVUK.userSurveys.init()}))})}(window.jQuery);